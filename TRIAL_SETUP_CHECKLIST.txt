âœ… FREE TRIAL SYSTEM - SETUP CHECKLIST

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FILES CREATED/UPDATED:

âœ… src/screens/main/PricingScreen.tsx
   - Added trial tier to pricing options
   - New handleStartTrial() function
   - Supabase import added
   - Database sync after purchase

âœ… src/lib/trialManager.ts (NEW)
   - checkTrialStatus()
   - handleExpiredTrial()
   - getTierWithTrialCheck()
   - formatTrialTimeRemaining()
   - getTrialMessage()

âœ… SUPABASE_TRIAL_MIGRATION.sql (NEW)
   - Adds trial columns to profiles table
   - Creates active_trials view
   - Creates expired_trials view

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SETUP STEPS (DO IN ORDER):

STEP 1: Run Supabase Migration (REQUIRED)
â–¡ Go to Supabase Dashboard
â–¡ Select your project
â–¡ Click "SQL Editor"
â–¡ Create new query
â–¡ Copy entire SUPABASE_TRIAL_MIGRATION.sql file
â–¡ Paste into editor
â–¡ Click "Run" button
â–¡ Wait for success message

This adds:
âœ… trial_started_at column
âœ… trial_ends_at column
âœ… subscription_tier column
âœ… subscription_status column
âœ… active_trials view
âœ… expired_trials view

STEP 2: Update useAuthBootstrap (OPTIONAL)
â–¡ Open src/hooks/useAuthBootstrap.ts
â–¡ Add import: import { getTierWithTrialCheck } from '@/lib/trialManager';
â–¡ After loading profile, add trial check:
   const tierWithTrial = await getTierWithTrialCheck(session.user.id);
   const profileWithTier = { ...profile, subscription_tier: tierWithTrial };
   setProfile(profileWithTier);

This ensures trial status is checked on app startup.

STEP 3: Verify Supabase Import
â–¡ Open src/screens/main/PricingScreen.tsx
â–¡ Check line 19 has: import { supabase } from '@/lib/supabaseClient';

STEP 4: Rebuild App
â–¡ Run: expo start --clear
â–¡ Wait for build complete

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TESTING (DO IN ORDER):

TEST 1: Start Trial
â–¡ Create new test account
â–¡ Open pricing screen
â–¡ Should see 3 options:
  â–¡ ğŸ Try Free (7-Day Free Trial)
  â–¡ âœ¨ Weekly ($4.99/week)
  â–¡ ğŸ† Lifetime ($69.99)
â–¡ Tap "Start Free Trial" button
â–¡ Should show loading indicator
â–¡ Should show: "ğŸ‰ Trial Started! You have 7 days..."
â–¡ Dashboard should show subscription: "WEEKLY"
â–¡ Check Supabase (Profiles table):
  â–¡ trial_started_at should have timestamp
  â–¡ trial_ends_at should be 7 days from now
  â–¡ subscription_tier should be "weekly"
  â–¡ subscription_status should be "active"

TEST 2: Persistence After Restart
â–¡ Close app completely
â–¡ Reopen app
â–¡ Should still show "WEEKLY" subscription
â–¡ All 500+ frequencies should be playable
â–¡ Premium features should work (composer, baths, etc.)

TEST 3: Log Out and Back In
â–¡ Go to Profile
â–¡ Tap "Sign Out"
â–¡ Log back in with same email
â–¡ Should still show "WEEKLY" subscription âœ…
â–¡ Trial data persisted in database âœ…

TEST 4: Trial Already Used
â–¡ Fresh test account
â–¡ Start trial (TEST 1)
â–¡ Wait 7+ days (or manually set trial_ends_at to today in Supabase)
â–¡ Try to tap "Start Free Trial" again
â–¡ Should show: "âš ï¸ Trial Already Used"
â–¡ Should prevent re-use âœ…

TEST 5: Upgrade During Trial
â–¡ With active trial
â–¡ Tap "Subscribe Weekly" (not trial button)
â–¡ Complete purchase flow
â–¡ Should succeed
â–¡ Should convert to paid subscription
â–¡ Trial status should not matter

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

WHAT SHOULD HAPPEN:

Trial Flow:
1. User sees "ğŸ Try Free" button prominently
2. Taps it
3. App records start date in Supabase
4. User gets immediate access to "weekly" tier (all 500+ frequencies)
5. App shows "WEEKLY" on dashboard
6. Everything works as if paid
7. After 7 days:
   - App detects expiration
   - Automatically downgrades to free
   - User loses premium access
   - User sees upgrade prompt

User Benefits:
âœ… No credit card needed for trial
âœ… Full access to all premium features
âœ… 7 days to decide before commitment
âœ… Easy upgrade path to paid
âœ… Trial status persistent (survives app restart)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DATABASE COLUMNS ADDED:

profiles table gets 4 new columns:

trial_started_at (timestamp)
  - When user started trial
  - NULL if no trial started
  - Example: 2026-01-17T14:30:00Z

trial_ends_at (timestamp)
  - When trial expires (always 7 days after start)
  - NULL if no trial started
  - Example: 2026-01-24T14:30:00Z

subscription_tier (text)
  - Current tier: 'free', 'weekly', 'lifetime'
  - Trial users shown as 'weekly'
  - Default: 'free'

subscription_status (text)
  - 'active' or 'inactive'
  - Trial users: 'active'
  - Expired users: 'inactive'
  - Default: 'inactive'

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

MONITORING (Optional):

In Supabase SQL Editor, check trial health:

-- Count active trials
SELECT COUNT(*) FROM active_trials;

-- See users about to expire
SELECT id, email, days_remaining FROM active_trials WHERE days_remaining <= 1;

-- See expired trials
SELECT id, email, days_expired FROM expired_trials;

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ISSUES TO WATCH:

âš ï¸ Migration not ran?
   â†’ You'll get "column trial_started_at not found" error
   â†’ Run SUPABASE_TRIAL_MIGRATION.sql

âš ï¸ Trial doesn't persist on restart?
   â†’ useAuthBootstrap not updated
   â†’ Add getTierWithTrialCheck call

âš ï¸ Can start trial multiple times?
   â†’ handleStartTrial not checking trial_started_at
   â†’ Check code for "if (currentProfile?.trial_started_at)"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

READY TO DEPLOY âœ…

All systems in place:
âœ… Trial pricing screen
âœ… Database tracking
âœ… Automatic expiration
âœ… Persistence across restarts
âœ… One trial per user
âœ… Full premium access during trial

Next: Run migration â†’ Test â†’ Deploy!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
